\section{Definitions}
\label{sec:definition}
Let $\mathbb{O} = \{o_1 ,o_2,...,o_n\}$ be the set of objects and $\mathbb{T} =\{1,2,...,m\}$ be the descritized temporal dimension. A time sequence $T$ is defined as a subset of $\mathbb{T}$, i.e., $T \subseteq \mathbb{T}$, and we use $|T|$ to denote sequence length. Let $T_i$ be $i$-th entry in $T$ and we say $T$ is consecutive if $\forall 1\leq i\leq |T|-1$, $T_{i+1} = T_i + 1$. It is obvious that any time sequence $T$ can be decomposed into consecutive segments and we say $T$ is \textit{L-consecutive}~\cite{li2015platoon} if the length of all the consecutive segments is no smaller than $L$. 

As illustrate in Figure~\ref{fig:platoon_weakpoint}, patterns adapting the notion of $L$-consecutiveness (e.g., \emph{platoon} and \emph{group}) still suffer from \emph{loose connection} problem. 
To avoid such an anomaly without losing pattern generality, we introduce a parameter $G$ to control the gaps between
timestamps in a pattern. Formally, a $G$-connected time sequence is defined as follows:
%To control the closeness of timestamps, we further define the $G$-connected of a time sequence as follows: WHAT THE RELATIONSHIP BETWEEN CLOSENESS AND G-CONNECTED?
%
%
%We say a sequence $T$ is \emph{(fully)consecutive}
%if and only if $\forall T[i] \in T, T[i+1] \in T$, $T[i+1] = T[i] + 1$. A subsequence $T^m$ is \emph{maximally consecutive}~\cite{li2015platoon} wrt. $T$ if and only if $T^m \subseteq T$ and $\nexists T^{m'}, T^m \subseteq T^{m'} \wedge T^{m'} $ is consecutive. For example, let $T=\{1,2,3,5,6\}$, then $T_1=\{1,2,3\}$ and $T_2=\{5,6\}$ are two maximally consecutive subsequences wrt. $T$. We then define the $L$-consecutiveness as follows:

%\begin{definition}[$L$-consecutive~\cite{li2015platoon}]
%A time sequence $T$ is $L$-consecutive if each of its consecutive portions 
%has cardinality greater or equal to $L$.
%\end{definition}


\begin{definition}[$G$-connected]
A time sequence $T$ is $G$-connected if the gap between any of its neighboring timestamps is no greater than $G$. That is
 $\forall T_i,T_{i+1} \in T, T_{i+1}-T_{i} \leq G$.
\end{definition}

We take $T=\{1,2,3,5,6\}$ as an example, which can be decomposed into two consecutive segments $\{1,2,3\}$ and $\{5,6\}$. $T$ is not $3$-consecutive since the length $\{5,6\}$ is $2$. Thus, it is safe to say either $T$ is $1$-consecutive or $2$-consecutive. On the other hand, $T$ is $2$-connected since the maximum gap between its neighboring time stamps is $5-3=2$. It is worth noting that $T$ is not $1$-connected because the gap between $T_3$ and $T_4$ is 2 (i.e., 5-3=2).

%Given a timestamp $t$, objects with their locations at $t$ collectively form a \emph{snapshot}\footnote{Missing time stamps can be interpreted using existing methods such as linear interpolation~\cite{jeung2008convoy}.}.Objects in a snapshot can then be clustered based on the closeness of their locations. Let $C_t(o_i)$ be the cluster which $o_i$ belongs to at time $t$, a general co-movement pattern can be defined as:
Given a trajectory database descritized into snapshots, we can conduct a clustering method, either disk-based or density-based, to identify groups with spatial proximity. Let $T$ be the set of timestamps in which a group of objects $O$ are clustered. We are ready to define a more general co-movement pattern:
\begin{definition}[General Co-Movement Pattern]
A general co-movement pattern finds a set of objects $O$ satisfying the following five constraints: 1) \textit{closeness:} the objects in $O$ belong to the same cluster in the timestamps of $T$; 2) \textit{significance:} $|O| \geq M$; 3) \textit{duration:} $|T| \geq K$; 4) \textit{consecutiveness:} $T$ is L-consecutive; and 5) \textit{connection:} $T$ is $G$-connected.

%\begin{enumerate}
%\item{Closeness: $\forall o_i,o_j \in O, \forall t \in T, C_t(o_i) = C_t(o_j)$}
%\item{Significance: $|O| \geq M$}
%\item{Duration: $|T| \geq K$}
%\item{Consecutiveness: $T$ is $L$-consecutive}
%\item{Separateness: $T$ is $G$-separated}
%\end{enumerate} 
\end{definition}
There are four parameters in our general co-movement pattern, including object constraint $M$ and temporal constraints $K,L,G$. By customizing these parameters, our pattern can 
express other patterns proposed in previous literature, as illustrated in Table~\ref{tbl:patterns}. 
In particular, by setting $G=|T|$, we achieve the \emph{platoon} pattern. By setting $G=|T|,L=1$, we achieve the \emph{swarm} pattern. By setting $G=|T|$, $M=2$, $K=1$, we gain the \emph{group} pattern. Finally by setting $G=1$, we achieve the \emph{convoy} and \emph{flock} pattern. 
In addition to the flexibility of representing other existing patterns, our GCMP is able to avoid the \emph{loose connection} anomaly by tuning the parameter $G$. 
%In addition to covering existing patterns, the general co-movement pattern avoids the \emph{loose connection} problem in \emph{platoon} pattern. 
%
%As suggested previously, $\{1,2, 100,101\}$ will be included in the platoon pattern, however since they're too far away, this pattern is not prominent. By setting appropriate $G$, we are able to prune this anomaly. 
It is notable that GCMP cannot be modeled by existing patterns. %AS MENTIONED IN WECHAT, POLISH THIS PART.

%The general co-movement pattern retains the patterns that discovered by all 
%existing techniques (group, flock, convoy, swarm and platoon). 
%The relationships between general co-movement pattern and other patterns are summarized 
\begin{table}
\centering
\begin{tabular}{|l|c|c|c|c|c|}
\hline 
Pattern & $M$ & $K$ & $L$ & $G$ & Clustering\\ 
\hline
Group & $2$ & $1$ & $2$ & $|\mathbb{T}|$ & Disk-based\\
\hline
Flock & $\cdot$ & $\cdot$ & $K$ & $1$ & Disk-based \\
\hline 
Convoy & $\cdot$ & $\cdot$ & $K$ & $1$ & Density-based\\ 
\hline 
Swarm & $\cdot$ & $\cdot$ & $1$ & $|\mathbb{T}|$ & Density-based \\ 
\hline 
Platoon & $\cdot$ & $\cdot$ & $\cdot$ & $|\mathbb{T}|$ & Density-based\\ 
\hline 
\end{tabular} 
\caption{Expressing other patterns using GCMP. $\cdot$ indicate a user specified value. $M$ represents the 
object \emph{size} constraints. $K$ represents \emph{duration} constraint. $L$ represents \emph{consecutiveness} constraint. $G$ represents the \emph{connection} constraints.}
\label{tbl:patterns}
\end{table}
 
It is also observable that the number of patterns in GCMP could be exponential under some parameter settings (i.e., 
when expressing \emph{swarm}). In particular, given a parameter $M$, if a pattern $P$ is valid, then any subset of $P$ with 
size $M$ is also a valid pattern. This results in additional $\Sigma_{M\geq i \geq |P.O|} {|P.O| \choose i}$ patterns,
which is clearly overwhelming and redundant. For all these patterns, output $P$ is sufficient. Therefore, we define the \emph{Closed General Co-Movement Pattern} as follows:
%
%To reduce the size of output, 
%we notice that, for two patterns $P_1,P_2$, if $P_1.O \subseteq P_2.O$ and $P_2$ is a proper pattern, then $P_1$ is also a proper pattern. 

\begin{definition}[Closed General Co-Movement Pattern]
A general co-moving pattern $P=\langle O:T \rangle$ is closed if and only if there does not exist another general co-moving pattern $P'$ s.t. $P.O \subseteq P'.O$.
\end{definition}

For example, let $M=2,K=2,,L=1,G=1$. In Figure~\ref{fig:related_work},
the pattern $P_1 = \{o_3,o_4:1,2,3\}$ is not a closed pattern. This is because $P_2=\{o_3,o_4,o_5:2,3\}$ is a closed pattern since $P_2.O \supset P_1.O$. The closed pattern avoids outputting duplicate information, thus making the result patterns more compact. 
%LETS KEEP THE CLOSED INFORMATION AT THE MOMENT. IF NO CLOSED IS DEFINED, WE CANNOT REDUCE GCMP TO OTHER PATTERNS SINCE THOSE PATTERNS ARE ALL DEFINED AS ``CLOSED''
%For example, let $n=2,k=2,l=1,g=1$, the pattern $\{o_3,o_4\} \{1,2,3\}$ in Figure~\ref{fig:related_work} is not a closed pattern, while $\{o_3, o_4\} \{t_1,t_2,t_3\}$ is a closed pattern. 

%Although the general co-moving pattern is free from the clustering methods used at each snapshot, as suggested in~\cite{jeung2008convoy}, the \emph{density}-based clustering method is better in detecting object clusters with arbitrary spatio-shapes. Therefore in this paper, we mainly consider density-based clustering.
Our definition of GCMP is free from clustering method. Users are able to supply different clustering methods to facilitate different application needs. 
We currently expose both disk-region based clustering and DBSCAN as options to the user.

In summary, the goal of this paper is to present a parallel solution for discovering closed GCMP from large-scale trajectory data.

Before we move on to the algorithmic part, we list the notations that are used in the following sections.

\begin{table}[h]
\centering
\begin{tabular}{|c|l|} 
\hline
Symbols & Meanings \\
\hline
$S_t$ & snapshot of objects at time $t$ \\
\hline 
$\mathbb{O}$ & set of objects \\ 
\hline
$M$ & object size constraint \\
\hline 
$K$ & duration constraint\\
\hline
$L$ & consecutiveness constraint\\
\hline
$G$ & connection constraint \\
\hline
$P=(O:T)$ & pattern with object set $O$, time sequence $T$\\
\hline
$\eta$ & replication factor in TRM\\
\hline
$C_t(o)$ & the cluster of object $o$ at time $t$ \\
\hline 
$S_t$ & the set of clusters at time $t$\\
\hline 
$\lambda_i$ & the partition with snapshots $S_t,..,S_{t+\eta-1}$ \\
\hline
$Sr_i $ &  the star of object $i$ \\
\hline 
\end{tabular} 
\caption{Symbols and notions that will be used}
\end{table}